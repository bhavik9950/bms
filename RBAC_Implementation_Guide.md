# Role-Based Access Control (RBAC) Implementation Guide

## Overview
This guide will help you implement RBAC in your Laravel boutique management system, allowing different user types (Admin, Technical Admin, Staff) to access appropriate features through the same login system.

## ðŸŽ¯ User Types & Permissions

### **1. Admin (Super User)**
- **Access**: Full system access
- **Responsibilities**: System configuration, user management, all CRUD operations
- **Dashboard**: Complete admin panel with all modules

### **2. Technical Admin (Coder/Developer)**
- **Access**: Development and technical features
- **Responsibilities**: Code updates, system maintenance, technical configurations
- **Dashboard**: Limited admin features + development tools

### **3. Staff (Employee)**
- **Access**: Limited to personal tasks and attendance
- **Responsibilities**: Mark attendance, view assigned tasks, personal profile
- **Dashboard**: Simple interface for daily operations

## ðŸ—„ï¸ Database Structure

### Users Table Enhancement
Add role field to existing users table:

```sql
ALTER TABLE users ADD COLUMN role ENUM('admin', 'technical_admin', 'staff') DEFAULT 'staff';
ALTER TABLE users ADD COLUMN is_active BOOLEAN DEFAULT TRUE;
```

### Permissions Table (Optional - for granular control)
```sql
CREATE TABLE permissions (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(255) UNIQUE,
    description TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE role_permissions (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    role ENUM('admin', 'technical_admin', 'staff'),
    permission_id BIGINT,
    FOREIGN KEY (permission_id) REFERENCES permissions(id)
);
```

## ðŸ”§ Implementation Steps

### Step 1: Update User Model
```php
// app/Models/User.php
class User extends Authenticatable
{
    protected $fillable = [
        'name',
        'email',
        'password',
        'role',
        'is_active'
    ];

    protected $casts = [
        'is_active' => 'boolean',
    ];

    // Helper methods for roles
    public function isAdmin()
    {
        return $this->role === 'admin';
    }

    public function isTechnicalAdmin()
    {
        return $this->role === 'technical_admin';
    }

    public function isStaff()
    {
        return $this->role === 'staff';
    }

    public function hasRole($role)
    {
        return $this->role === $role;
    }
}
```

### Step 2: Create Role-Based Middleware
```bash
php artisan make:middleware RoleMiddleware
```

```php
// app/Http/Middleware/RoleMiddleware.php
namespace App\Http\Middleware;

use Closure;
use Illuminate\Http\Request;

class RoleMiddleware
{
    public function handle(Request $request, Closure $next, $role)
    {
        if (!auth()->check()) {
            return redirect()->route('login');
        }

        if (!auth()->user()->hasRole($role) && !auth()->user()->isAdmin()) {
            abort(403, 'Unauthorized access');
        }

        return $next($request);
    }
}
```

Register middleware in `app/Http/Kernel.php`:
```php
protected $routeMiddleware = [
    // ... existing middleware
    'role' => \App\Http\Middleware\RoleMiddleware::class,
];
```

### Step 3: Create Role-Based Controllers

#### Base Controller with Role Checks
```php
// app/Http/Controllers/Controller.php
abstract class Controller
{
    protected function checkRole($role)
    {
        if (!auth()->user()->hasRole($role) && !auth()->user()->isAdmin()) {
            abort(403, 'Access denied');
        }
    }

    protected function getUserDashboard()
    {
        $user = auth()->user();

        if ($user->isAdmin()) {
            return 'dashboard.admin.index';
        } elseif ($user->isTechnicalAdmin()) {
            return 'dashboard.technical.index';
        } else {
            return 'dashboard.staff.index';
        }
    }
}
```

#### Staff Controller (Limited Access)
```php
// app/Http/Controllers/Staff/DashboardController.php
class DashboardController extends Controller
{
    public function index()
    {
        $this->checkRole('staff');

        $user = auth()->user();
        $todayAttendance = // Get today's attendance for this user
        $assignedTasks = // Get tasks assigned to this user

        return view('dashboard.staff.index', compact('todayAttendance', 'assignedTasks'));
    }

    public function markAttendance(Request $request)
    {
        $this->checkRole('staff');

        // Mark attendance logic
        // Only allow marking for current user
    }
}
```

### Step 4: Role-Based Routes

#### Web Routes (`routes/web.php`)
```php
// Public routes
Route::get('/', function () {
    return redirect()->route('login');
});

// Authentication routes (auto-generated by Laravel)

// Protected routes with role-based access
Route::middleware(['auth', 'verified'])->group(function () {

    // Common dashboard redirect based on role
    Route::get('/dashboard', function () {
        $user = auth()->user();

        if ($user->isAdmin()) {
            return redirect()->route('admin.dashboard');
        } elseif ($user->isTechnicalAdmin()) {
            return redirect()->route('technical.dashboard');
        } else {
            return redirect()->route('staff.dashboard');
        }
    })->name('dashboard');

    // Admin routes
    Route::middleware('role:admin')->prefix('admin')->name('admin.')->group(function () {
        Route::get('/dashboard', [AdminController::class, 'index'])->name('dashboard');
        // All admin routes here
        Route::resource('users', UserController::class);
        Route::resource('staff', StaffController::class);
        Route::resource('orders', OrderController::class);
        // ... all admin features
    });

    // Technical Admin routes
    Route::middleware('role:technical_admin')->prefix('technical')->name('technical.')->group(function () {
        Route::get('/dashboard', [TechnicalController::class, 'index'])->name('dashboard');
        // Limited admin features + technical tools
        Route::get('/system-info', [TechnicalController::class, 'systemInfo'])->name('system.info');
        Route::get('/logs', [TechnicalController::class, 'logs'])->name('logs');
        // Read-only access to most features
    });

    // Staff routes
    Route::middleware('role:staff')->prefix('staff')->name('staff.')->group(function () {
        Route::get('/dashboard', [Staff\DashboardController::class, 'index'])->name('dashboard');
        Route::post('/attendance/mark', [Staff\AttendanceController::class, 'mark'])->name('attendance.mark');
        Route::get('/tasks', [Staff\TaskController::class, 'index'])->name('tasks');
        Route::get('/profile', [Staff\ProfileController::class, 'index'])->name('profile');
        // Only personal features
    });
});
```

### Step 5: Role-Based Views

#### Dynamic Sidebar Based on Role
```php
// resources/views/layouts/sidebar.blade.php
@php
    $user = auth()->user();
    $isAdmin = $user->isAdmin();
    $isTechnicalAdmin = $user->isTechnicalAdmin();
    $isStaff = $user->isStaff();
@endphp

<!-- Dashboard Link - All users -->
<a href="{{ route('dashboard') }}">Dashboard</a>

@if($isAdmin || $isTechnicalAdmin)
    <!-- Admin/Technical Admin Menu -->
    <a href="{{ route('admin.orders.index') }}">Orders</a>
    <a href="{{ route('admin.staff.index') }}">Staff Management</a>
    @if($isAdmin)
        <a href="{{ route('admin.users.index') }}">User Management</a>
    @endif
@endif

@if($isStaff || $isAdmin)
    <!-- Staff Menu -->
    <a href="{{ route('staff.attendance.index') }}">My Attendance</a>
    <a href="{{ route('staff.tasks.index') }}">My Tasks</a>
@endif

@if($isTechnicalAdmin)
    <!-- Technical Menu -->
    <a href="{{ route('technical.system.info') }}">System Info</a>
    <a href="{{ route('technical.logs') }}">System Logs</a>
@endif
```

### Step 6: User Registration/Assignment

#### Seeder for Default Users
```php
// database/seeders/UserSeeder.php
public function run()
{
    // Create admin user
    User::create([
        'name' => 'System Admin',
        'email' => 'admin@boutique.com',
        'password' => Hash::make('password'),
        'role' => 'admin',
        'is_active' => true,
    ]);

    // Create technical admin
    User::create([
        'name' => 'Technical Admin',
        'email' => 'tech@boutique.com',
        'password' => Hash::make('password'),
        'role' => 'technical_admin',
        'is_active' => true,
    ]);

    // Create sample staff
    User::factory()->create([
        'role' => 'staff',
        'is_active' => true,
    ]);
}
```

#### Admin User Management Interface
```php
// Admin can change user roles
public function updateRole(Request $request, User $user)
{
    $request->validate([
        'role' => 'required|in:admin,technical_admin,staff',
    ]);

    $user->update(['role' => $request->role]);

    return back()->with('success', 'User role updated successfully');
}
```

## ðŸŽ¨ UI Implementation

### Different Dashboards

#### Admin Dashboard
- Full statistics overview
- User management panel
- System configuration
- All CRUD operations

#### Technical Admin Dashboard
- System health monitoring
- Log viewer
- Performance metrics
- Limited configuration access

#### Staff Dashboard
- Today's attendance status
- Assigned tasks list
- Personal profile
- Simple, clean interface

### Login Flow
```php
// In LoginController
public function redirectTo()
{
    $user = auth()->user();

    if ($user->isAdmin()) {
        return route('admin.dashboard');
    } elseif ($user->isTechnicalAdmin()) {
        return route('technical.dashboard');
    } else {
        return route('staff.dashboard');
    }
}
```

## ðŸ”’ Security Considerations

### 1. **Route Protection**
- All sensitive routes protected by role middleware
- CSRF protection on forms
- Input validation and sanitization

### 2. **Data Access Control**
```php
// Staff can only see their own data
public function myAttendance()
{
    $this->checkRole('staff');

    $attendance = Attendance::where('user_id', auth()->id())->get();

    return view('staff.attendance', compact('attendance'));
}
```

### 3. **Audit Logging**
```php
// Log important actions
public function updateStaff(Request $request, Staff $staff)
{
    $this->checkRole('admin');

    // Log the action
    Log::info('Staff updated', [
        'user' => auth()->user()->name,
        'staff_id' => $staff->id,
        'changes' => $request->all()
    ]);

    $staff->update($request->validated());
}
```

## ðŸš€ Implementation Plan

### Phase 1: Basic RBAC Setup
1. âœ… Add role field to users table
2. âœ… Create role middleware
3. âœ… Update User model with helper methods
4. âœ… Create role-based routes

### Phase 2: Dashboard Separation
1. Create separate dashboard views for each role
2. Implement role-based navigation
3. Add role-specific features

### Phase 3: Staff Web Interface
1. Create staff-specific routes and controllers
2. Build attendance marking interface
3. Implement task viewing system
4. Test all staff functionalities

### Phase 4: Testing & Refinement
1. Test role permissions thoroughly
2. Implement proper error handling
3. Add user feedback and validation
4. Performance optimization

## ðŸ“± Staff Web Interface Features

### Attendance Management
- Mark daily attendance
- View attendance history
- Request leave/absence

### Task Management
- View assigned tasks
- Update task status
- Submit work completion

### Profile Management
- View personal information
- Update contact details
- Change password

## ðŸ”„ Migration to Mobile App

Once the web interface is complete and tested:

1. **API Development**: Create JSON APIs for all staff features
2. **Flutter Integration**: Use the same API endpoints
3. **Authentication**: JWT tokens for mobile sessions
4. **Offline Support**: Cache data for offline functionality

## ðŸŽ¯ Benefits

- **Security**: Proper access control prevents unauthorized access
- **User Experience**: Each user sees only relevant features
- **Maintainability**: Clean separation of concerns
- **Scalability**: Easy to add new roles or permissions
- **Testing**: Web interface allows thorough testing before mobile development

This RBAC system provides a solid foundation for both your web application and future mobile app development.